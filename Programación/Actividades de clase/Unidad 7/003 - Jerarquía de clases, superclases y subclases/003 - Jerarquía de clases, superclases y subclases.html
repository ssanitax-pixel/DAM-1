<!doctype html>
<html>
<head>
<style>
  #nave { position:absolute; width:50px; }
  .roca { width:50px; position:absolute; }
  .bala { width:15px; position:absolute; }
  body { background:url("estrellas.jpeg"); background-size:cover; }
</style>
</head>
<body>
  <img src="nave.png" id="nave">
</body>
<script>
let anchopagina = window.innerWidth;
let altopagina = window.innerHeight;

// Clases
class Entidad { constructor(x,y,a,v){ this.posx=x; this.posy=y; this.angulo=a; this.velocidad=v; } }
class Bala extends Entidad { constructor(x,y,a,v){ super(x,y,a,v); } }
class Jugador extends Entidad { constructor(x,y,a,v){ super(x,y,a,v); } }
class Roca extends Entidad { constructor(x,y,a,e,v){ super(x,y,a,v); this.escala=e; } }

// Crear rocas y sus elementos DOM
let numero_rocas = 10;
let rocas = [];
for(let i=0;i<numero_rocas;i++){
  let roca = new Roca(Math.random()*500, Math.random()*500, Math.random()*360, Math.random(), 2);
  let rocaDOM = document.createElement("img");
  rocaDOM.classList.add("roca");
  rocaDOM.src = "roca.png";
  rocaDOM.style.left = roca.posx + "px";
  rocaDOM.style.top = roca.posy + "px";
  rocaDOM.style.transform = "rotate("+roca.angulo+"deg) scale("+roca.escala+")";
  document.body.appendChild(rocaDOM);
  roca.DOM = rocaDOM; // guardamos referencia al DOM
  rocas.push(roca);
}

// Crear jugador
let nave = document.querySelector("#nave");
let jugador = new Jugador(Math.random()*anchopagina, Math.random()*altopagina, 0, 0);
nave.style.left = jugador.posx+"px";
nave.style.top = jugador.posy+"px";

// Balas
let balas = [];

// Movimiento jugador y disparo
document.onkeydown = function(tecla){
  switch(tecla.keyCode){
    case 87: jugador.posy -=5; break; // W
    case 83: jugador.posy +=5; break; // S
    case 65: jugador.posx -=5; break; // A
    case 68: jugador.posx +=5; break; // D
    case 32: // Barra espaciadora
      let bala = new Bala(jugador.posx+20, jugador.posy, 0, 10);
      balas.push(bala);
      let balaDOM = document.createElement("img");
      balaDOM.classList.add("bala");
      balaDOM.src = "bala.png";
      balaDOM.style.left = bala.posx + "px";
      balaDOM.style.top = bala.posy + "px";
      document.body.appendChild(balaDOM);
      bala.DOM = balaDOM;
      break;
  }
  nave.style.left = jugador.posx+"px";
  nave.style.top = jugador.posy+"px";
}

// Función de animación
function animar(){
  // Mover rocas
  rocas.forEach(r => {
    r.posx += Math.cos(r.angulo*Math.PI/180) * r.velocidad;
    r.posy += Math.sin(r.angulo*Math.PI/180) * r.velocidad;

    // rebote en bordes
    if(r.posx < 0 || r.posx > anchopagina-50) r.velocidad *= -1;
    if(r.posy < 0 || r.posy > altopagina-50) r.velocidad *= -1;

    r.DOM.style.left = r.posx + "px";
    r.DOM.style.top = r.posy + "px";
  });

  // Mover balas hacia arriba
  balas.forEach((b,i)=>{
    b.posy -= b.velocidad;
    if(b.posy < 0) { 
      b.DOM.remove(); 
      balas.splice(i,1); 
    } else {
      b.DOM.style.top = b.posy + "px";
    }
  });

  requestAnimationFrame(animar);
}

animar();
</script>
</html>

